version: 2.1

base_image: &base_image
  hashicorp/terraform:light

working_directory: &working_directory
  ~/ameyrupji

default_config: &default_config
  docker:
    - image: *base_image
  working_directory: *working_directory

orbs:
  aws-s3: circleci/aws-s3@1.0.0

workflows:
  build-test-deploy:
    jobs:
      - deploy2s3:
        <<: *default_config
        steps:
          - checkout
          - run: mkdir bucket && echo "lorum ipsum" > bucket/build_asset.txt
          # - aws-s3/sync:
          #     from: bucket
          #     to: 's3://ameyrupji.com/'
          #     arguments: |
          #       --acl public-read \
          #       --cache-control "max-age=86400"
          #     overwrite: true
          - aws-s3/copy:
              from: bucket/build_asset.txt
              to: 's3://ameyrupji.com/'
              # arguments: '--dryrun'