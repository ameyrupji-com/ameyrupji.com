version: 2.1

orbs:
  aws-s3: circleci/aws-s3@1.0.0

references:

base_image: &base_image
  hashicorp/terraform:light

working_directory: &working_directory
  ~/ameyrupji

default_config: &default_config
  docker:
    - image: *base_image
  working_directory: *working_directory

jobs:
  build:
    <<: *default_config
    steps:
      - checkout
      - run: 
        name: build
        command: | 
          pwd
          ls
  upload:
    <<: *default_config
    steps:
      - run: 
        name: create test file
        command: |
          mkdir bucket 
          echo "lorum ipsum" > bucket/build_asset.txt
      - aws-s3/copy:
          from: bucket/build_asset.txt
          to: 's3://ameyrupji.com/'

workflows:
  version: 2
  build-upload:
    jobs:
      - build
      - upload:
        requires:
            - build
        filters:
            branches:
              only: master
              